nextflow_process {

    name "Test Process LISTTOFILE"
    script "../main.nf"
    process "LISTTOFILE"

    tag "modules"
    tag "modules_local"
    tag "listtofile"
    tag "gawk"

    test("Aggregate all files into a list") {

        when {
            process {
                """
                input[0] = Channel.of([
                    [id: "all"],
                    [file("file1.txt"), file("file2.txt")],
                    ["A", "B"]
                ])
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert snapshot(process.out).match() },
                { assert snapshot(path(process.out.txt[0][1]).readLines()).match("Content_withid") },
                { assert snapshot(path(process.out.txt[0][2]).readLines()).match("Content_noid") },
                { assert snapshot(path(process.out.txt[0][3]).readLines()).match("Content_onlyid") }
            )
        }
    }
}
